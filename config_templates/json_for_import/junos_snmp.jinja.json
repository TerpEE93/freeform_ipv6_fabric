{
  "label": "junos_snmp.jinja",
  "text": "{% set snmp_prop = property_sets.get('snmp_properties', {} ) %}\n{% if 'enabled' in snmp_prop and snmp_prop.enabled %}\n    {% set sys_prop = property_sets.get('custom_sys_properties', {} ) %}\n    {% set mgt_vrf = sys_prop.mgt_vrf if 'mgt_vrf' in sys_prop else 'mgmt_junos' %}\n    {% set is_mgt_v6 = false %}\n    {% if 'mgt_prefix_v6' in sys_prop and sys_prop.mgt_prefix_v6 != '' %}\n        {% set mgt_prefix_v6 = sys_prop.mgt_prefix_v6|to_network %}\n        {% set management_ipv6 = [ mgt_prefix_v6, management_ip ]|join %}\n        {% set is_mgt_v6 = true%}\n    {% endif %}\n\nsnmp {\n    name {{ hostname }};\n    contact \"{{ snmp_prop.contact }}\";\n    filter-duplicates;\n    {% for k, v in snmp_prop.communities.items() %}\n    community {{ k }} {\n        authorization {{ v['authorization'] }};\n            {% if 'clients' in v and v['clients'] != '' %}\n        clients {\n                {% for client in v['clients'] %}\n            {{ client }};\n                {% endfor %}\n        }\n            {% endif%}\n    }\n    {% endfor %}\n    trap-options {\n        routing-instance {{ mgt_vrf }} {\n    {% if is_mgt_v6 %}\n            source-address {{ management_ipv6 }};\n    {% else %}\n            source-address {{ management_ip }};\n    {% endif %}\n        }\n    }\n    {% if 'trap_groups' in snmp_prop and snmp_prop.trap_groups != '' %}\n        {% for k, v in snmp_prop.trap_groups.items() %}\n    trap-group {{ k }} {\n        routing-instance {{ mgt_vrf }};\n        version {{ v['version'] }};\n            {% if 'targets' in v and v['targets'] != '' %}\n        targets {\n                {% for target in v['targets'] %}\n            {{ target }};\n                {% endfor %}\n        }\n            {% endif %}\n    }\n        {% endfor %}\n    {% endif %}\n}\n{% endif %}\n{# EOF #}"
}