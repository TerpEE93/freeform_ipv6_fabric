{
  "label": "junos_filter.jinja",
  "text": "{% set sys_prop = property_sets.get('custom_sys_properties', {} ) %}\n{% set f_prop = property_sets.get('filter_properties', {} ) %}\n{% set ns = namespace() %}\n{% set ns.filter_v4 = [ ] %}\n{% set ns.filter_v6 = [ ] %}\n{% set ns.filter_eth = [ ] %}\n{% if f_prop != '' %}\n    {% for k, v in f_prop.items() %}\n        {% if v['family'] == 'inet' %}\n        {{ ns.filter_v4.append(k) or '' }}\n        {% elif v['family'] == 'inet6' %}\n        {{ ns.filter_v6.append(k) or '' }}\n        {% elif v['family'] == 'ethernet-switching' %}\n        {{ ns.filter_eth.append(k) or '' }}\n        {% endif %}\n    {% endfor %}\n{% endif %}\nreplace: firewall {\n{% if ('protect_re' in sys_prop and sys_prop.protect_re.enabled) or\n    ns.filter_v4 != '' %}\n    family inet {\n    {% if 'protect_re' in sys_prop and sys_prop.protect_re.enabled %}\n        filter Protect-RE_v4 {\n            term MGT {\n                from {\n                    source-prefix-list {\n                        MGT_SUBNETS_v4;\n                    }\n                    port [ ssh ntp radius radacct tacacs domain syslog snmp snmptrap 830 ];\n                }\n                then {\n                    count MGT_v4;\n                    accept;\n                }\n            }\n            term BGP {\n                from {\n                    port 179;\n                }\n                then {\n                    count BGP_v4;\n                    accept;\n                }\n            }\n            term DEFAULT {\n                then {\n                    count OTHER_v4;\n                    accept;\n                }\n            }\n        }\n    {% endif %}\n    {% if ns.filter_v4 != '' %}\n        {% for k, v in f_prop.items() %}\n            {% if k in ns.filter_v4 %}\n        filter {{ k }} {\n                {% for term in v['terms'] %}\n            term {{ term.term_name }} {\n                from {\n                    {% if 'src_prefix' in term and term.src_prefix != '' %}\n                    source-address {{ term.src_prefix }};\n                    {% endif %}\n                    {% if 'dst_prefix' in term and term.dst_prefix != '' %}\n                    destination-address {{ term.dst_prefix }};\n                    {% endif %}\n                    {% if 'prefix' in term and term.prefix != '' %}\n                    address {{ term.prefix }};\n                    {% endif %}\n                    {% if 'protocol' in term and term.protocol != '' %}\n                    protocol {{ term.protocol }};\n                    {% endif %}\n                    {% if 'src_port' in term and term.src_port != '' %}\n                    source-port {{ term.src_port }};\n                    {% endif %}\n                    {% if 'dst_port' in term and term.dst_port != '' %}\n                    destination-port {{ term.dst_port }};\n                    {% endif %}\n                }\n                then {\n                    {% if 'counter' in term and term.counter != '' %}\n                    count {{ term.counter }};\n                    {% endif %}\n                    {% if 'syslog' in term and term.syslog %}\n                    syslog;\n                    {% endif %}\n                    {% if 'pkt_action' in term and term.pkt_action != '' %}\n                    {{ term.pkt_action }};\n                    {% endif %}\n                }\n            }\n                {% endfor %}\n        }\n            {% endif %}\n        {% endfor %}\n    {% endif %}        \n    }\n{% endif %}\n{% if ('protect_re' in sys_prop and sys_prop.protect_re.enabled) or\n    ns.filter_v6 != '' %}\n    family inet6 {\n    {% if 'protect_re' in sys_prop and sys_prop.protect_re.enabled %}\n        filter Protect-RE_v6 {\n            term MGT {\n                from {\n                    source-prefix-list {\n                        MGT_SUBNETS_v6;\n                    }\n                    port [ ssh ntp radius radacct tacacs domain syslog snmp snmptrap 830 ];\n                }\n                then {\n                    count MGT_v6;\n                    accept;\n                }\n            }\n            term BGP {\n                from {\n                    port 179;\n                }\n                then {\n                    count BGP_v6;\n                    accept;\n                }\n            }\n            term DEFAULT {\n                then {\n                    count OTHER_v6;\n                    accept;\n                }\n            }\n        }\n    {% endif %}        \n    {% if ns.filter_v6 != '' %}\n        {% for k, v in f_prop.items() %}\n            {% if k in ns.filter_v6 %}\n        filter {{ k }} {\n                {% for term in v['terms'] %}\n            term {{ term.term_name }} {\n                from {\n                    {% if 'src_prefix' in term and term.src_prefix != '' %}\n                    source-address {{ term.src_prefix }};\n                    {% endif %}\n                    {% if 'dst_prefix' in term and term.dst_prefix != '' %}\n                    destination-address {{ term.dst_prefix }};\n                    {% endif %}\n                    {% if 'prefix' in term and term.prefix != '' %}\n                    address {{ term.prefix }};\n                    {% endif %}\n                    {% if 'next_header' in term and term.next_header != '' %}\n                    next-header {{ term.next_header }};\n                    {% endif %}\n                    {% if 'src_port' in term and term.src_port != '' %}\n                    source-port {{ term.src_port }};\n                    {% endif %}\n                    {% if 'dst_port' in term and term.dst_port != '' %}\n                    destination-port {{ term.dst_port }};\n                    {% endif %}\n                }\n                then {\n                    {% if 'counter' in term and term.counter != '' %}\n                    count {{ term.counter }};\n                    {% endif %}\n                    {% if 'syslog' in term and term.syslog %}\n                    syslog;\n                    {% endif %}\n                    {% if 'pkt_action' in term and term.pkt_action != '' %}\n                    {{ term.pkt_action }};\n                    {% endif %}\n                }\n            }\n                {% endfor %}\n        }\n            {% endif %}\n        {% endfor %}\n    {% endif %}\n    }\n{% endif %}\n{% if ns.filter_eth != '' %}\n    family ethernet-switching {\n    {% for k, v in f_prop.items() %}\n        {% if k in ns.filter_eth %}\n        filter {{ k }} {\n            {% for term in v['terms'] %}\n            term {{ term.term_name }} {\n                from {\n                {% if 'ipv4_src_prefix' in term and term.ipv4_src_prefix != '' %}\n                    ip-source-address {{ term.ipv4_src_prefix }};\n                {% endif %}\n                {% if 'ipv4_dst_prefix' in term and term.ipv4_dst_prefix != '' %}\n                    ip-destination-address {{ term.ipv4_dst_prefix }};\n                {% endif %}\n                {% if 'ipv4_prefix' in term and term.ipv4_prefix != '' %}\n                    ip-address {{ term.ipv4_prefix }};\n                {% endif %}\n                {% if 'ipv4_protocol' in term and term.ipv4_protocol != '' %}\n                    ip-protocol {{ term.ipv4_protocol }};\n                {% endif %}\n                {% if 'ipv6_src_prefix' in term and term.ipv6_src_prefix != '' %}\n                    ipv6-source-address {{ term.ipv6_src_prefix }};\n                {% endif %}\n                {% if 'ipv6_dst_prefix' in term and term.ipv6_dst_prefix != '' %}\n                    ipv6-destination-address {{ term.ipv6_dst_prefix }};\n                {% endif %}\n                {% if 'ipv6_prefix' in term and term.ipv6_prefix != '' %}\n                    ipv6-address {{ term.ipv6_prefix }};\n                {% endif %}\n                {% if 'ipv6_next_header' in term and term.ipv6_next_header != '' %}\n                    ipv6-next-header {{ term.ipv6_next_header }};\n                {% endif %}\n                {% if 'src_port' in term and term.src_port != '' %}\n                    source-port {{ term.src_port }};\n                {% endif %}\n                {% if 'dst_port' in term and term.dst_port != '' %}\n                    destination-port {{ term.dst_port }};\n                {% endif %}\n                }\n                then {\n                {% if 'counter' in term and term.counter != '' %}\n                    count {{ term.counter }};\n                {% endif %}\n                {% if 'syslog' in term and term.syslog %}\n                    syslog;\n                {% endif %}\n                {% if 'pkt_action' in term and term.pkt_action != '' %}\n                    {{ term.pkt_action }};\n                {% endif %}\n                }\n            }\n            {% endfor %}\n        }\n        {% endif %}\n    {% endfor %}\n    }\n{% endif %} \n}\n"
}